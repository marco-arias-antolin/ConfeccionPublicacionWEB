<!DOCTYPE html>
<html lang="es">

<head>
	<meta charset="UTF-8">
	<!--
	Copyright (C) 2023	Marco Arias - mail://marcoariasantolin@gmail.com

	This program is free software: you can redistribute it and/or modify
	it under the terms of the GNU General Public License as published by
	the Free Software Foundation, either version 3 of the License, or
	(at your option) any later version.

	This program is distributed in the hope that it will be useful,
	but WITHOUT ANY WARRANTY; without even the implied warranty of
	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
	GNU General Public License for more details.

	You should have received a copy of the GNU General Public License
	along with this program.  If not, see <http://www.gnu.org/licenses/>.

	Autor:			Marco Antonio Arias Antolín.
	Año:			2023
	Descripción:	Archivos a Base64
	Uso:			Didáctico.
	-->
	<link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIGhlaWdodD0nMjAwJyB3aWR0aD0nMjAwJyB2aWV3Qm94PScwIDAgMjAwIDIwMCc+DQoJPHRleHQgeD0nNTAlJyB5PScxMTBweCcgc3R5bGU9J2ZpbGw6I2FkYjViZDtkb21pbmFudC1iYXNlbGluZTpjZW50cmFsO2ZvbnQtc2l6ZTozMzNweDtmb250LWZhbWlseTpDb3VyaWVyO2ZvbnQtd2VpZ2h0OmJvbGQ7dGV4dC1hbmNob3I6bWlkZGxlJz5NPC90ZXh0Pg0KPC9zdmc+">
	<title>Archivos a Base64</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="author" content="Marco Antonio Arias Antolín">
	<meta name="description" content="Archivos a Base64.">
	<link rel="stylesheet" href="css/style.css">
	<script type="module">
		const fileInput = document.getElementById('fileInput');
		const outputDiv = document.getElementById('output');

		const createResultElement = ({ name, size, type }, base64Data) => {
			const resultDiv = document.createElement('div');
			let content = '';

			if (type.includes('image')) {
				content = `<img src="${base64Data}" style="max-width: 200px;">`;
			} else if (type.includes('text')) {
				fetch(base64Data)
					.then(response => response.arrayBuffer())
					.then(arrayBuffer => {
						const textContent = new TextDecoder().decode(arrayBuffer);
						content = `<textarea rows="6" cols="66" readonly>${textContent}</textarea>`;
						const divPreview = resultDiv.querySelector('.preview');
						divPreview.innerHTML = content;
					})
			} else {
				content = `<p>Contenido no previsualizable</p>`;
			}

			resultDiv.innerHTML = `
<h5>${name}</h5>
<p>Tamaño: ${size} bytes<br>
Tipo MIME: ${type}</p>
<p>Previsualización:</p>
<div class='preview'>${content}</div>
<p>base64:</p>
<textarea rows="6" cols="66" readonly>${base64Data}</textarea><br>
<button class="copyButton">Copiar</button>
`;
			return resultDiv;
		};

		const copyToClipboard = async (text) => {
			try {
				await navigator.clipboard.writeText(text);
				console.log('Texto copiado al portapapeles');
			} catch (error) {
				console.error('Error al copiar al portapapeles:', error);
			}
		};

		fileInput.onchange = async (event) => {
			outputDiv.innerHTML = ''; // Limpiar contenido anterior

			const files = event.target.files;

			for (const file of files) {
				const reader = new FileReader();
				reader.onload = ({ target: { result } }) => {
					const base64Data = result;

					const resultDiv = createResultElement(file, base64Data);
					const copyButton = resultDiv.querySelector('.copyButton');
					const textArea = resultDiv.querySelector('textarea:last-of-type');

					copyButton.onclick = () => {
						copyToClipboard(textArea.value);
					};

					outputDiv.appendChild(resultDiv);
				};

				reader.readAsDataURL(file);
			}
		};
	</script>
</head>

<body>
	<header>
		<h1>Codificador de Archivos a Base64</h1>
	</header>
	<main>
		<section>
			<h4>Selecciona archivos</h4>
			<input type="file" id="fileInput" multiple>
			<div id="output"></div>
		</section>
	</main>
	<footer>
		<span><span>&copy;</span> Marco Antonio Arias Antolín. 2023</span>
	</footer>
</body>

</html>